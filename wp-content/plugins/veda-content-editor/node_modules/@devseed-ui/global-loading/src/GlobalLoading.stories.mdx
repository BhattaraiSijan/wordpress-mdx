import { Meta, Story, Canvas } from '@storybook/addon-docs';

import { DevseedUiThemeProvider } from '@devseed-ui/theme-provider';
import { Button } from '@devseed-ui/button';

import {
  GlobalLoadingProvider,
  showGlobalLoading,
  hideGlobalLoading,
  showGlobalLoadingMessage,
} from '.';

export function MountLoader({ children }) {
  return (
    <>
      <GlobalLoadingProvider />
      {children}
    </>
  );
}

<Meta title="Components/Global Loading" />

# Global Loading

The global loading provides a way to display a loading indicator that covers the whole page, blocking interactions. It can be rendered through a programmatic api, or through a react component.

```
yarn add @devseed-ui/global-loading
```

```js
import {
  GlobalLoadingProvider,
  GlobalLoading,
  showGlobalLoading,
  hideGlobalLoading,
  showGlobalLoadingMessage,
} from '@devseed-ui/global-loading';
```

## Setup

The global loading needs the `<GlobalLoadingProvider />` to be mounted on a parent component. It should only be mounted once, so consider mounting at the root level. If you try to use the global loading without the provider mounted and error will be thrown.

```jsx
import { GlobalLoadingProvider } from '@devseed-ui/global-loading';
import { DevseedUiThemeProvider } from '@devseed-ui/theme-provider';

export default function App() {
  return (
    <DevseedUiThemeProvider>
      <GlobalLoadingProvider />
    </DevseedUiThemeProvider>
  );
}
```

## Import

```js
import {
  GlobalLoadingProvider,
  showGlobalLoading,
  hideGlobalLoading,
  showGlobalLoadingMessage,
  GlobalLoading,
} from '@devseed-ui/global-loading';
```

### Example (via programmatic api)
The programmatic api is useful when the global loading has to be shown in response to callbacks.
For simplicity sake, the following example uses buttons.

<Canvas>
  <Story name='Simple'>
    <MountLoader>
      <Button
        variation="primary-fill"
        onClick={() => {
          showGlobalLoading();
          setTimeout(() => {
            hideGlobalLoading();
          }, 1000);
        }}
      >
        Global Loading
      </Button>
    </MountLoader>
  </Story>
</Canvas>

#### With changing text

<Canvas>
  <Story name='With text'>
    <MountLoader>
      <Button
        variation="primary-fill"
        onClick={() => {
          showGlobalLoadingMessage(
            'The global loading can display a simple text message.',
          );
          setTimeout(() => {
            showGlobalLoadingMessage(
              'The message can be updated while the loading is visible.',
            );
          }, 2500);
          setTimeout(() => {
            hideGlobalLoading();
          }, 5000);
        }}
      >
        Global Loading Message
      </Button>
    </MountLoader>
  </Story>
</Canvas>

### Controlling via react component

The global loading will be shown when the `<GlobalLoading />` is mounted, and hidden when it is unmounted.
